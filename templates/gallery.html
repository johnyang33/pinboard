<!doctype html>
<html>
<head>
    <title>PinBoard-{{ current_path }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <!-- MACRO: START -->
    {% macro render_tree(nodes) %}
    <ul class="tree">
        {% for node in nodes %}
        <li class="{{ 'open' if node.active }} folder">
            {% if node.children %}
                <details id="folder-{{ node.path|replace('/', '-') }}" {{ 'open' if node.active }}>
                    <summary>
                        {% if node.file_count > 0 %}
                            <a href="/gallery/{{ node.path }}">{{ node.name }}</a>
                        {% else %}
                            {{ node.name }}
                        {% endif %}

                        <span class="count">
                            ({{ node.file_count }} files{% if node.folder_count %}, {{ node.folder_count }} folders{% endif %})
                        </span>
                    </summary>
                    {{ render_tree(node.children) }}
                </details>
            {% else %}
                <a href="/gallery/{{ node.path }}">{{ node.name }}</a>
                <span class="count">
                    ({{ node.file_count }} files)
                </span>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% endmacro %}
    <!-- MACRO: END -->
<div class="container">
    <main>
        <aside id="sidebar" class="collapsed">
            <button id="toggle-aside" aria-label="Toggle sidebar">☰</button>
            <div class="navtree">    
                {{ render_tree(tree) }}
            </div>
        </aside>
        <nav id="content_bar">
            <ul style="list-style:none; padding:0; display:flex; gap:6px;">
                {% for crumb in breadcrumbs %}
                    <li>
                        {% if not loop.last %}
                            <a href="{{ crumb.url }}">{{ crumb.name }}</a> /
                        {% else %}
                            <strong>{{ crumb.name }}</strong>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>

            <div class="favorites_wrapper">
                <div class="showing">
                    {% if favorites_only %}
                        <p><strong>Currently only showing favorites</strong></p>
                    {% endif %}
                </div>
                <div class="showing">
                    {% if favorites_only %}
                        <a href="/gallery/{{ current_path }}">✰Show all✰</a>
                    {% else %}
                        <a href="/gallery/{{ current_path }}?favorites=1">⭐Show favorites only⭐</a>
                    {% endif %}
                </div>

            </div>
        </nav>
        <div class="image_container">
            {% if images %}
                {% for img in images %}
                    <div class="media-item">
                        <a href="{{ url_for('media_file', filename=img.path) }}">
                            <img src="{{ url_for('media_file', filename=img.path) }}">
                        </a>

                        <div class="caption">
                            <div>{{ img.display_name }}</div>
                            <button class="fav-btn"
                                    data-path="{{ img.path }}"
                                    onclick="toggleFavorite(this)">
                                {{ "⭐" if img.favorite else "✰" }}
                            </button>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
            {% if videos %}
                {% for vid in videos %}
                    <div class="media-item video">
                        <video class="viddd" preload="metadata" controls loop>
                            <source src="{{ url_for('media_file', filename=vid.path) }}">
                        </video>

                        <div class="caption">
                            <div>{{ vid.display_name }}</div>
                            <button class="fav-btn"
                                    data-path="{{ vid.path }}"
                                    onclick="toggleFavorite(this)">
                                {{ "⭐" if vid.favorite else "✰" }}
                            </button>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div><!-- images_container-->    
    </main>
</div><!-- container -->

<div style="margin-top:50px;"id="bottom_linkz">
    <div class="pc">
        <a style="color:darkorange;" href="http://localhost:8790/">MainDB</a>
        <a href="http://127.0.0.1:8789/">CrimeDB</a>
       <a style="color:lightsalmon;"href="http://localhost:8787/">AudiobookDB</a>
       <a href="http://localhost:9999/">Snipz</a>
       <a style="color:blue;" href="http://localhost:8080/">PinBoard</a>
       <a style="color:lightcoral;" href="http://localhost:8000/">Counter</a>
       <a href="http://localhost:7000/">JungAPP</a>
    </div>
    <div class="pi">
        <a href="http://192.168.254.70:9999">Snipz-Pi</a>
        <a href="http://192.168.254.70:7000/">Jung-Pi</a>
    </div>
</div>


<script>
function toggleFavorite(btn) {
    const path = btn.dataset.path;

    fetch("/favorite/toggle", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ path })
    })
    .then(r => r.json())
    .then(data => {
        btn.textContent = data.favorite ? "★" : "☆";
        location.reload(); // simple & reliable
    });
}
</script>
<script>
    document.getElementById("toggle-aside").addEventListener("click", () => {
  document.getElementById("sidebar").classList.toggle("collapsed");
});
</script>
<script>
// Load open/closed state from localStorage
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("details").forEach(details => {
        const id = details.id;
        const state = localStorage.getItem(id);
        if (state === "open") {
            details.open = true;
        } else if (state === "closed") {
            details.open = false;
        }

        // Save state on toggle
        details.addEventListener("toggle", () => {
            localStorage.setItem(id, details.open ? "open" : "closed");
        });
    });
});
</script>
<script>
      // Set volume for all videos with a specific class
  document.querySelectorAll('.viddd').forEach(video => {
    video.volume = 0.05; // 50% volume
  });
    </script>

</body>
</html>
